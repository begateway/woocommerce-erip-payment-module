# Модуль оплаты для системы "Расчёт" (ЕРИП) через агрегатора bePaid.by

[Версия для WooCommerce 2.x](https://github.com/begateway/woocommerce-erip-payment-module/tree/woocommerce-2)

## Установка

  - Создайте резервную копию вашего магазина и базы данных
  - Загрузите архив модуля [woocommerce-erip-payments.zip](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/woocommerce-erip-payments.zip)
  - Зайдите в панель администратора Wordpress (www.yoursite.com/wp-admin/)
  - Выберите __Плагины -> Добавить новый__
  - Нажмите __Загрузить плагин__
  - Выберите архив плагина _woocommerce-erip-payments.zip_ и установите
  - Выберите __Плагины -> Установленные__ и найдите _WooCommerce ЕРИП платежи_ плагин и активируйте его.

![Добавить новый плагин](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_7.jpg)

![Загрузить новый плагин](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_6.jpg)

![Установить новый плагин](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_5.jpg)

![Активировать новый плагин](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_4.png)

## Настройка

Зайдите в **WooCommerce -> Настройки -> Платежи**

![Настройки плагина](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_3.jpg)

Вверху страницы вы увидите закладку __Платежи__. Нажмите на её, а затем ссылку __ЕРИП__, чтобы перейти к настройкам ЕРИП плагина.

![Перейти к настройкам ЕРИП плагина](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_2.png)

Задайте настройки, которые вы получили от bePaid или используйте тестовые данные, которые вы можете найти ниже.

![Настройки ЕРИП плагина](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/01_1.png)

  - Разрешите оплату через ЕРИП, поставив галочку **Разрешить**
  - Id магазина и его ключ, можно найти в личном кабинете bePaid
  - Введите в **Код услуги в системе ЕРИП** код услуги, присвоенный bePaid и который был указан в анкете услуги при подаче документов в ЕРИП
  - Введите в **Сообщение в чеке после оплаты** информацию, которую нужно отобразить на ЕРИП чеке в случае успешной оплаты
  - Введите в **Название способа оплаты** название данного способа оплаты для покупателя. Будет отображено на странице выбора способа оплаты заказа
  - Введите в **Описание способа оплаты для покупателя** текст, который будет информировать покупателя, что это за способ оплаты. Будет отображено на странице выбора способа оплаты заказа
  - Введите в **Текст-подтверждение заказа для ручного режима** информацию, которую нужно отобразить на странице подтверждения заказа в случае, когда выбран ручной способ выставления счёта в ЕРИП
  - Введите в **Текст-подтверждение заказа для автоматического режима** информацию, которую нужно отобразить на странице подтверждения заказа в случае, когда выбран автоматический способ выставления счёта в ЕРИП
  - Введите в **Текст для e-mail сообщения с инструкцией об оплате** текст письма, которое отсылается покупателю, когда счёт в ЕРИП был выставлен
  - Введите в **Оплата действительна (минут)** количество минут, в течении которых покупатель должен оплатить заказ через ЕРИП
  - Выберите в **Создание счёта в ЕРИП** режим работы с ЕРИП. Автоматический режим означает, что счёт в ЕРИП будет создан сразу же и клиенту будет показана инструкция как оплатить. В ручном режиме менеджер магазина должен сам сформировать счёт в ЕРИП, используя меню на странице данных о заказе
  - Отметьте галочку **Журнал отладки**, чтобы записывать в журнал данные об инфообмене с API bePaid. Журнал доступен по пути **WooCommerce -> Статус -> Журналы**
  - нажмите кнопку **Сохранить изменения** и ваш магазин настроен принимать платежи через ЕРИП

## Работа с плагином

WooCommerce будет автоматически создавать требования в ЕРИП и выслать инструкцию об оплате покупателю в случае выбора в настройках модуля автоматического режима работы. Заказу будет присвоен статус _В ожидании оплаты_.

Если был выбран режим ручного создания счёта в ЕРИП, то заказу присваивается статус _На удержании_. Менеджер должен перейти на страницу данных о заказе и в блоке **ЕРИП действия** нажать кнопку _Создать счёт в ЕРИП_.

Нажать **Сохранить Заказ**. WooCommerce создаст требование в ЕРИП и переведет заказ в статус _В ожидании оплаты_.

![Создать счёт в ЕРИП](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/create_erip_1.png)

После получения оплаты через ЕРИП, WooCommerce получит уведомление о платеже и переведет статус заказа _Обработка_.

Менеджер может отменить счёт в ЕРИП пока он не оплачен. Для этого в блоке **ЕРИП действия** нажать кнопку _Отменить счёт в ЕРИП_.

![Отменить счёт в ЕРИП](https://github.com/beGateway/woocommerce-erip-payment-module/raw/master/doc/cancel_erip_1.png)

Номер операции на стороне bePaid можно найти в данных заказа в блоке __ЕРИП действия__.

## Примечания

Разработанно и протестировано с WordPress 5.x и WooCommerce 4.x

## Тестовые данные

Вы можете использовать следующие данные, чтобы настроить ЕРИП платежи в тестовом режиме:

  - Код услуги в системе ЕРИП **99999999**

Если у вас нет еще зарегистрированного магазина в системе bePaid, то вы можете использовать следующие данные:

  - ID магазина **4225**
  - Ключ магазина **3834fbef1fe6ea024ef77f5c79ec7ff1ba710ea6241c08c2f341afda8af4c1c4**
